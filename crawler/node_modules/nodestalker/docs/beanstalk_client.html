<!DOCTYPE html>

<html>
<head>
  <title>beanstalk_client.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>beanstalk_client.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Includes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> events = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>),
	net = <span class="hljs-built_in">require</span>(<span class="hljs-string">'net'</span>),
	util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>),
	yaml = <span class="hljs-built_in">require</span>(<span class="hljs-string">'js-yaml'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h3 id="simple-debug-console">simple debug console</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Debug = <span class="hljs-keyword">new</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">var</span> active = <span class="hljs-literal">false</span>;

	<span class="hljs-keyword">this</span>.log = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(str)</span> </span>{
		<span class="hljs-keyword">if</span>(active) {
			<span class="hljs-built_in">console</span>.log(str.toString());
		}
	};

	<span class="hljs-keyword">this</span>.activate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		active = <span class="hljs-literal">true</span>;
	};
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3 id="job-wrapper">Job wrapper</h3>
<p>returns an object that represents a job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> BeanstalkJob = {};
BeanstalkJob.create = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
	<span class="hljs-keyword">if</span>(data.length == <span class="hljs-number">2</span>) {
		<span class="hljs-keyword">return</span> {
			id : data[<span class="hljs-number">0</span>],
			data : data[<span class="hljs-number">1</span>]
		};
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="internal-command-object">Internal command object</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">BeanstalkCommand</span><span class="hljs-params">(obj)</span> </span>{
	<span class="hljs-keyword">this</span>._obj = obj;
	events.EventEmitter.call(<span class="hljs-keyword">this</span>);
};
util.inherits(BeanstalkCommand, events.EventEmitter);

BeanstalkCommand.prototype.commandObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._obj;
};

BeanstalkCommand.prototype.command = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cmd)</span> </span>{
	<span class="hljs-keyword">if</span>(!cmd) {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._obj.hasOwnProperty(<span class="hljs-string">'command'</span>) ? <span class="hljs-keyword">this</span>._obj.command : <span class="hljs-literal">null</span>;
	}
	<span class="hljs-keyword">this</span>._obj.command = cmd;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.expected = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(expected)</span> </span>{
	<span class="hljs-keyword">if</span>(!expected) {
		<span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.commandObject();
		<span class="hljs-keyword">if</span>( obj.hasOwnProperty(<span class="hljs-string">'expected'</span>) ) {
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> obj.expected === <span class="hljs-string">"string"</span>) ? [ obj.expected ] : obj.expected;
		}
		<span class="hljs-keyword">return</span> [];
	}
	<span class="hljs-keyword">this</span>._obj.expected = expected;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.isYaml = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(isYaml)</span> </span>{
	<span class="hljs-keyword">if</span>(!isYaml) {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._obj.hasOwnProperty(<span class="hljs-string">'is_yaml'</span>) ? <span class="hljs-keyword">this</span>._obj.is_yaml : <span class="hljs-number">0</span>;
	}
	<span class="hljs-keyword">this</span>._obj.is_yaml = isYaml;
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>simulates callback style, but calls immediately, in order to inject
subcommands into expected call queue location</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkCommand.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span> </span>{
	fn();
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.onEnd = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span> </span>{
	<span class="hljs-keyword">this</span>.addListener(<span class="hljs-string">'command_error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
		fn(err, <span class="hljs-literal">null</span>);
	});

	<span class="hljs-keyword">this</span>.addListener(<span class="hljs-string">'command_success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
		fn(<span class="hljs-literal">null</span>, data);
	});

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.onError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span> </span>{
	<span class="hljs-keyword">this</span>.addListener(<span class="hljs-string">'command_error'</span>, fn);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.onSuccess = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fn)</span> </span>{
	<span class="hljs-keyword">this</span>.addListener(<span class="hljs-string">'command_success'</span>, fn);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

BeanstalkCommand.prototype.multiBuffer = <span class="hljs-literal">null</span>;
BeanstalkCommand.prototype.multiErrorTimer = <span class="hljs-literal">null</span>;
BeanstalkCommand.prototype.multiErrorOccurred = <span class="hljs-literal">false</span>;

BeanstalkCommand.prototype.responseHandler = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, callback)</span> </span>{
	
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.multiErrorOccurred) {
		Debug.log(<span class="hljs-string">'responseHandler skip'</span>);
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	}

	<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, firstLine, jobdata, lines;
	<span class="hljs-keyword">var</span> dataString = data.toString();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>if weâ€™re handling an additional http chunk</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.multiBuffer) {
		clearTimeout(<span class="hljs-keyword">this</span>.multiErrorTimer);
		dataString = <span class="hljs-keyword">this</span>.multiBuffer + dataString;
	}

	Debug.log( <span class="hljs-string">"responseHandler data: '"</span> + dataString + <span class="hljs-string">"'"</span>);

	lines = dataString.split(<span class="hljs-string">'\r\n'</span>);
	firstLine = lines.shift();
	<span class="hljs-keyword">var</span> chunks = firstLine.split(<span class="hljs-string">' '</span>);

	<span class="hljs-keyword">var</span> expected = <span class="hljs-keyword">this</span>.expected();
	<span class="hljs-keyword">var</span> expected_match = <span class="hljs-literal">false</span>;

	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;expected.length; i++) {
		<span class="hljs-keyword">if</span>(expected[i] === chunks[<span class="hljs-number">0</span>]) {
			expected_match = <span class="hljs-literal">true</span>;
		}
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>for RESERVED responses, check if we need additional http chunks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> matches = <span class="hljs-regexp">/^RESERVED \d+ (\d+)\r\n([\s\S]+)$/g</span>.exec(dataString);
	<span class="hljs-keyword">if</span>(matches) {
		<span class="hljs-keyword">var</span> expectedLength = <span class="hljs-built_in">Number</span>(matches[<span class="hljs-number">1</span>]); 

		<span class="hljs-keyword">if</span>(matches[<span class="hljs-number">2</span>].length &lt; (expectedLength + <span class="hljs-number">2</span>)) {
			Debug.log( <span class="hljs-string">'responseHandler waiting for more'</span> );
			<span class="hljs-keyword">this</span>.multiBuffer = dataString;
			
			<span class="hljs-keyword">this</span>.multiErrorTimer = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
				self.emit(<span class="hljs-string">'command_error'</span>, chunks);
				self.multiErrorOccurred = <span class="hljs-literal">true</span>;
			}, <span class="hljs-keyword">this</span>._obj.reserve_multichunk_timeout);
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		}
	}

	<span class="hljs-keyword">if</span>(!expected_match) {
		Debug.log( <span class="hljs-string">'responseHandler command_error'</span> );
		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'command_error'</span>, chunks);
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>handle multiline data correctly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(lines.length &gt; <span class="hljs-number">1</span>) {
		lines.pop();			
		jobdata = lines.join(<span class="hljs-string">'\r\n'</span>);
	}

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isYaml() &amp;&amp; jobdata) {
		Debug.log( <span class="hljs-string">'responseHandler command_success isYaml'</span> );
		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'command_success'</span>, yaml.load(jobdata));
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">if</span>(chunks.length &gt; <span class="hljs-number">1</span>) {
			chunks.shift();

			<span class="hljs-keyword">if</span>(jobdata) {
				chunks.pop();
				chunks.push(jobdata);
				chunks = BeanstalkJob.create(chunks);
			}
		}

		Debug.log( <span class="hljs-string">'responseHandler command_success'</span> );
		<span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'command_success'</span>, chunks);
	}

	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="beanstalk-client">Beanstalk client</h2>
<p> A client that binds to one single socket</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">BeanstalkClient</span><span class="hljs-params">()</span> </span>{
	events.EventEmitter.call(<span class="hljs-keyword">this</span>);

	<span class="hljs-keyword">this</span>.address = <span class="hljs-string">'127.0.0.1'</span>;
	<span class="hljs-keyword">this</span>.port = <span class="hljs-number">11300</span>;
	<span class="hljs-keyword">this</span>.conn;
	<span class="hljs-keyword">this</span>.default_priority = <span class="hljs-number">10</span>;
	<span class="hljs-keyword">this</span>.reserve_multichunk_timeout = <span class="hljs-number">500</span>;

	<span class="hljs-keyword">this</span>.queue = [];
	<span class="hljs-keyword">this</span>.waitingForResponses = <span class="hljs-literal">false</span>;
};
util.inherits(BeanstalkClient, events.EventEmitter);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Singleton like method that returns an instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.Instance = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(config)</span> </span>{
	<span class="hljs-keyword">if</span> (config) {
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config == <span class="hljs-string">'string'</span>) {
			<span class="hljs-keyword">var</span> c = config.split(<span class="hljs-string">':'</span>);
			<span class="hljs-keyword">this</span>.address = c[<span class="hljs-number">0</span>] || <span class="hljs-keyword">this</span>.address;
			<span class="hljs-keyword">this</span>.port = c[<span class="hljs-number">1</span>] || <span class="hljs-keyword">this</span>.port;
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">this</span>.address = config.address || <span class="hljs-keyword">this</span>.address;
			<span class="hljs-keyword">this</span>.port = config.port || <span class="hljs-keyword">this</span>.port;
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>executes command</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.command = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> </span>{
	<span class="hljs-keyword">var</span> _self = <span class="hljs-keyword">this</span>;
	obj.reserve_multichunk_timeout = <span class="hljs-keyword">this</span>.reserve_multichunk_timeout;
	<span class="hljs-keyword">var</span> cmd = <span class="hljs-keyword">new</span> BeanstalkCommand(obj);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>pushes commands to the server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> requestExec = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">if</span>(!_self.waitingForResponse &amp;&amp; _self.queue.length) {
			_self.waitingForResponse = <span class="hljs-literal">true</span>;
			<span class="hljs-keyword">var</span> cmd = _self.queue.shift();

			<span class="hljs-keyword">if</span>(_self.conn) {
				_self.conn.removeAllListeners(<span class="hljs-string">'data'</span>);
				_self.conn.addListener(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
					Debug.log(<span class="hljs-string">'response:'</span>);
					Debug.log(data);
					cmd.responseHandler.call(cmd, data);
				});
			}
			Debug.log(<span class="hljs-string">'request:'</span>);
			Debug.log(cmd.command());
			process.nextTick(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
				_self.conn.write(cmd.command());
			});
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>makes sure that if thereâ€™s another command queued, it gets done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	cmd.addListener(<span class="hljs-string">'command_success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
		_self.waitingForResponse = <span class="hljs-literal">false</span>;
		requestExec();
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>if the command fails, event an error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	cmd.addListener(<span class="hljs-string">'command_error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
		_self.waitingForResponse = <span class="hljs-literal">false</span>;
		_self.emit(<span class="hljs-string">'end'</span>, <span class="hljs-string">'Command failed'</span>);
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>put every command into the local queue to control execution order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">this</span>.queue.push(cmd);

	<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.conn) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>if thereâ€™s no connection, create one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">this</span>.conn = net.createConnection(<span class="hljs-keyword">this</span>.port, <span class="hljs-keyword">this</span>.address);
		<span class="hljs-keyword">this</span>.conn.setNoDelay();
		<span class="hljs-keyword">this</span>.conn.setKeepAlive();

		<span class="hljs-keyword">this</span>.conn.addListener(<span class="hljs-string">'connect'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
			Debug.log(<span class="hljs-string">'connected: '</span>+_self.address+<span class="hljs-string">':'</span>+_self.port);
			requestExec();
		});

		<span class="hljs-keyword">this</span>.conn.addListener(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
			_self.emit(<span class="hljs-string">'end'</span>, err);
			Debug.log(<span class="hljs-string">'connection ended, writeOnly from now on'</span>);
		});

		<span class="hljs-keyword">this</span>.conn.addListener(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
			_self.emit(<span class="hljs-string">'error'</span>, err);
			Debug.log(<span class="hljs-string">'connection error'</span>);
		});

		<span class="hljs-keyword">this</span>.conn.addListener(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
			_self.emit(<span class="hljs-string">'close'</span>, err);
			Debug.log(<span class="hljs-string">'connection closed'</span>);
		});
	} <span class="hljs-keyword">else</span> {
		requestExec();
	}

	<span class="hljs-keyword">return</span> cmd;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>disconnects a client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.disconnect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">this</span>.conn.end();
	<span class="hljs-keyword">this</span>.conn.destroy();
	<span class="hljs-keyword">this</span>.conn = <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="beanstalk-client-commands">Beanstalk client commands</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3 id="use">use</h3>
<p>uses tube, this is for producers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.use = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tube)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'use '</span>+tube+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'USING'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="watch">watch</h3>
<p>watches tube, this is for receivers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.watch = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tube)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'watch '</span>+tube+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'WATCHING'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3 id="ignore">ignore</h3>
<p>ignores tube</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.ignore = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tube)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'ignore '</span>+tube+<span class="hljs-string">'\r\n'</span>,
		expected: [<span class="hljs-string">'WATCHING'</span>, <span class="hljs-string">'NOT_IGNORED'</span>]
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3 id="put">put</h3>
<p>puts data in a tube</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.put = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, priority, delay, ttr)</span> </span>{
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> priority == <span class="hljs-string">'undefined'</span>) {
		priority = <span class="hljs-keyword">this</span>.default_priority;
	}

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> delay == <span class="hljs-string">'undefined'</span>) {
		delay = <span class="hljs-number">0</span>;
	}

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> ttr == <span class="hljs-string">'undefined'</span>) {
		ttr = <span class="hljs-number">100000</span>;
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'put '</span>+priority+<span class="hljs-string">' '</span>+delay+<span class="hljs-string">' '</span>+ttr+<span class="hljs-string">' '</span>+Buffer.byteLength(data.toString(), <span class="hljs-string">'utf8'</span>)+<span class="hljs-string">'\r\n'</span>+data+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'INSERTED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h3 id="reserve">reserve</h3>
<p>picks up job from tube</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.reserve = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'reserve\r\n'</span>,
		expected: <span class="hljs-string">'RESERVED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3 id="reserve">reserve</h3>
<p>picks up job from tube, with timeout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.reserve_with_timeout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(time)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'reserve-with-timeout '</span>+time+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'RESERVED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.reserveWithTimeout = BeanstalkClient.prototype.reserve_with_timeout;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="touch">touch</h3>
<p>tell the server that youâ€™re still working on a job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.touch = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'touch '</span>+id+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'TOUCHED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3 id="delete">delete</h3>
<p>delets job from queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.deleteJob = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'delete '</span>+id+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'DELETED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h3 id="release">release</h3>
<p>releases job from reserved state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.release = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id, priority, delay)</span> </span>{
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> priority == <span class="hljs-string">'undefined'</span>) {
		priority = <span class="hljs-keyword">this</span>.default_priority;
	}

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> delay == <span class="hljs-string">'undefined'</span>) {
		delay = <span class="hljs-number">0</span>;
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'release '</span>+id+<span class="hljs-string">' '</span>+priority+<span class="hljs-string">' '</span>+delay+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'RELEASED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3 id="bury">bury</h3>
<p>buries job so it isnâ€™t picked up by reserve</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.bury = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id, priority)</span> </span>{
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> priority == <span class="hljs-string">'undefined'</span>) {
		priority = <span class="hljs-keyword">this</span>.default_priority;
	}

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'bury '</span>+id+<span class="hljs-string">' '</span>+priority+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'BURIED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3 id="kick">kick</h3>
<p>kicks buried job back into queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.kick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bound)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'kick '</span>+bound+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'KICKED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3 id="peek">peek</h3>
<p>letâ€™s you inspect a job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peek = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'peek '</span>+id+<span class="hljs-string">'\r\n'</span>,
		expected: [ <span class="hljs-string">'FOUND'</span>, <span class="hljs-string">'NOT_FOUND'</span> ]
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3 id="peek-ready">peek-ready</h3>
<p>letâ€™s you inspect the next ready job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peek_ready = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'peek-ready\r\n'</span>,
		expected: [ <span class="hljs-string">'FOUND'</span>, <span class="hljs-string">'NOT_FOUND'</span> ]
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peekReady = BeanstalkClient.prototype.peek_ready;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h3 id="peek-delayed">peek-delayed</h3>
<p>letâ€™s you inspect the next delayed job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peek_delayed = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'peek-delayed\r\n'</span>,
		expected: [ <span class="hljs-string">'FOUND'</span>, <span class="hljs-string">'NOT_FOUND'</span> ]
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peekDelayed = BeanstalkClient.prototype.peek_delayed;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h3 id="peek-buried">peek-buried</h3>
<p>letâ€™s you inspect the next buried job</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peek_buried = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'peek-buried\r\n'</span>,
		expected: [ <span class="hljs-string">'FOUND'</span>, <span class="hljs-string">'NOT_FOUND'</span> ]
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.peekBuried = BeanstalkClient.prototype.peek_buried;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3 id="stats">stats</h3>
<p>gives statistical information about the server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.stats = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'stats\r\n'</span>,
		expected: <span class="hljs-string">'OK'</span>,
		is_yaml: <span class="hljs-number">1</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h3 id="stats-job">stats-job</h3>
<p>gives statistical information about the specified job if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.stats_job = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'stats-job '</span>+id+<span class="hljs-string">'\r\n'</span>,
		expected: [<span class="hljs-string">'OK'</span>, <span class="hljs-string">'NOT_FOUND'</span>],
		is_yaml: <span class="hljs-number">1</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.statsJob = BeanstalkClient.prototype.stats_job;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h3 id="stats-tube">stats-tube</h3>
<p>gives statistical information about the specified tube if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.stats_tube = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tube)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'stats-tube '</span>+tube+<span class="hljs-string">'\r\n'</span>,
		expected: [<span class="hljs-string">'OK'</span>, <span class="hljs-string">'NOT_FOUND'</span>],
		is_yaml: <span class="hljs-number">1</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.statsTube = BeanstalkClient.prototype.stats_tube;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h3 id="list-tubes">list-tubes</h3>
<p>lists all existing tubes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.list_tubes = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'list-tubes\r\n'</span>,
		expected: <span class="hljs-string">'OK'</span>,
		is_yaml: <span class="hljs-number">1</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.listTubes = BeanstalkClient.prototype.list_tubes;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h3 id="list-tubes-watched">list-tubes-watched</h3>
<p>lists all existing tubes that are currently watched</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.list_tubes_watched = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'list-tubes-watched\r\n'</span>,
		expected: <span class="hljs-string">'OK'</span>,
		is_yaml: <span class="hljs-number">1</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.listTubesWatched = BeanstalkClient.prototype.list_tubes_watched;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h3 id="list-tube-used">list-tube-used</h3>
<p>returns the tube currently being used by the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.list_tube_used = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'list-tube-used\r\n'</span>,
		expected: <span class="hljs-string">'USING'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.listTubeUsed = BeanstalkClient.prototype.list_tube_used;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h3 id="pause-tube">pause-tube</h3>
<p>can delay any new job being reserved for a given time</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.pause_tube = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(tube, delay)</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'pause-tube '</span>+tube+<span class="hljs-string">' '</span>+delay+<span class="hljs-string">'\r\n'</span>,
		expected: <span class="hljs-string">'PAUSED'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>camel case alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.pauseTube = BeanstalkClient.prototype.pause_tube;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h3 id="quit">quit</h3>
<p>closes connection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BeanstalkClient.prototype.quit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.command({
		command: <span class="hljs-string">'quit\r\n'</span>
	});
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2 id="exposed-to-node">Exposed to node</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Beanstalk = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(server)</span> </span>{
	<span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> BeanstalkClient;
	<span class="hljs-keyword">return</span> c.Instance(server);
};

exports.Client = Beanstalk;
exports.Debug = Debug;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
